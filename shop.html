<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Магазин</title>
    <style>
body {
    background-color: rgb(0, 0, 0); /* Черный фон */
    min-height: calc(100vh + 10cm); /* Увеличиваем минимальную высоту на 2 см */
    display: flex; /* Используем flexbox для центрирования */
    flex-direction: column; /* Упорядочиваем элементы по вертикали */
    justify-content: flex-start; /* Элементы идут сверху */
    align-items: center; /* Центрирование по горизонтали */
    font-size: 1rem; /* Базовый размер шрифта */
    padding: 1rem;
    color: white; /* Цвет текста */
    user-select: none; /* Запрет на выделение текста */
    position: relative; /* Для правильного отображения псевдоэлементов */
    overflow-y: auto; /* Добавляем вертикальную прокрутку */
    -webkit-overflow-scrolling: touch; /* Для плавной прокрутки на мобильных устройствах */
    font-size: 15px; /* Размер шрифта изменится в зависимости от ширины экрана */
    font-family: 'Roboto', sans-serif;
}

        /* Контейнер для звезд */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1; /* Фон ниже содержимого */
        }

        /* Стиль каждой звезды */
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: flyStar 5s linear infinite;
        }

        /* Анимация для текста покупки */
        #purchase-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px; /* Уменьшаем размер шрифта */
            white-space: nowrap; /* Оставляем текст в одну строку */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            color: white;
            z-index: 10;
        }

        #crystalsCount, #keysCount {
            font-size: 20px;
            letter-spacing: 1.2px;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 2;
        }

        #keysCount {
            top: 60px;
        }

        @keyframes flyStar {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(100vw);
                opacity: 0;
            }
        }
        /* Контейнер для кнопок и описания товаров */
        .button-container {
    display: flex;
    justify-content: center; /* Центрирование кнопок по горизонтали */
    gap: 20px;
    margin-top: 100px;
}

.shop-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(145deg, #1f1f1f, #292929); /* Градиентный фон */
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5); /* Тень */
    transition: transform 0.3s, box-shadow 0.3s;
}

.shop-item:hover {
    transform: translateY(-10px); /* Подпрыгивание при наведении */
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.7); /* Усиление тени */
}

.shop-button {
    width: 60px;
    height: 60px;
    background-color: transparent;
    border-radius: 10px;
    cursor: pointer;
    overflow: hidden;
    border: none;
}

.shop-button img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.item-description {
    text-align: center;
    margin-top: 10px;
}

.buy-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(90deg, #ff7b00, #ff3d00); /* Градиентный фон */
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(255, 61, 0, 0.5); /* Тень */
    transition: transform 0.2s, box-shadow 0.3s;
}

.buy-button:hover {
    transform: scale(1.1); /* Увеличение при наведении */
    box-shadow: 0 6px 10px rgba(255, 61, 0, 0.7); /* Усиление тени */
}


.buy-button img {
    width: 20px;
    vertical-align: middle;
}
.buy-button {
    transition: background-color 0.5s ease, color 0.5s ease;
}
.buy-button span {
    margin-left: 10px;
}
  
/* Анимация мигания */
@keyframes blink {
    50% {
        opacity: 0.5;
    }
}

/* Анимация подпрыгивания */
@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

/* Применяем анимацию к блоку с подарком дня, когда подарок доступен */
#dailyGift.available {
    animation: blink 1s infinite, bounce 0.5s infinite;
    border-color: yellow;
}
.footer {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(62, 58, 58, 0.5);
            padding: 10px 0;
            position: fixed;
            bottom: 10px;
            width: 95%;
            border-radius: 15px;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .footer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .footer-item:hover {
            transform: translateY(-5px);
        }

        .footer-item img {
            width: 28px;
            height: 28px;
            margin-bottom: 5px;
        }

        .footer-item span {
            font-size: 12px;
        }
.button-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 100px;
}
@media (max-width: 600px) {
    body {
        font-size: 12px;
        padding: 10px;
    }
    .shop-button {
        width: 50px;
        height: 50px;
    }
}
.tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .tab {
    background-color: #2d2d2d;
    color: #fff;
    border-radius: 25px;
    padding: 10px 20px;
    font-weight: bold;
    transition: background-color 0.3s, transform 0.3s;
}

.tab.active {
    background: linear-gradient(90deg, #007bff, #0056b3); /* Активная вкладка */
    transform: scale(1.1); /* Увеличение активной вкладки */
}


        .tabcontent {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .tabcontent.active {
            display: flex;
        }
        .tabcontent {
    display: none;
    animation: fadeIn 0.5s ease-in-out; /* Анимация */
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tabcontent.active {
    display: flex;
}

        .shop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .shop-button {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            overflow: hidden;
        }

        .shop-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-description {
            margin-top: 10px;
            text-align: center;
        }

        .buy-button {
            margin-top: 10px;
            padding: 6px 16px;
            font-size: 16px;
            background-color: transparent;
            color: white;
            border: 1px solid white;
            border-radius: 5px;
            cursor: pointer;
        }

        #skins {
    display: none; /* Скрыт по умолчанию */
}

#skins.active {
    display: grid; /* Показываем, только если добавлен класс active */
}

   #skins {
            grid-template-columns: repeat(2, 1fr); /* Две колонки */
            gap: 20px; /* Расстояние между элементами */
            justify-items: center; /* Центрируем элементы по горизонтали */
        }
        .counter-icon {
    width: 24px; /* Задайте подходящий размер изображения */
    height: 24px;
    margin-right: 8px; /* Отступ между изображением и текстом */
    vertical-align: middle; /* Выравнивание по центру */
}

#reward-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background-color: blue;
            color: white;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
            cursor: pointer;
            display: none;
        }

        @keyframes boxOpen {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.5);
        }
        100% {
            transform: scale(0);
        }
    }

    @keyframes fadeInMove {
        0% {
            opacity: 0;
            transform: translateY(50px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .reward-display {
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-radius: 10px;
        padding: 10px 20px;
        margin: 10px;
        font-size: 18px;
        animation: fadeInMove 1s ease;
    }

    .reward-display img {
        width: 30px;
        height: 30px;
        margin-right: 10px;
    }

        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @keyframes drop {
            0% {
                transform: translateY(-200px);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(0);
            }
        }

        .box-animation {
            animation: drop 1s ease;
        }

             /* Общий стиль для контейнера */
             .container {
            display: flex;
            flex-direction: column; /* Элементы в колонку */
            gap: 20px; /* Отступы между элементами */
        }

        /* Стиль для покупки ключей */
        .purchase-key {
            display: block; /* Блоковый элемент */
            padding: 10px;
            background-color: #f4f4f4;
            border: 1px solid #ccc;
        }

        /* Стиль для ящиков */
        .box {
            display: block; /* Блоковые элементы */
            padding: 10px;
            background-color: #e0e0e0;
            border: 1px solid #ccc;
        }

    </style>
</head>
<body>
<h1 style='text-align: center; color: white;'>Магазин</h1>
    <div id="purchase-message"></div>
    <div id="crystalsCount">
        <img src="5.png" alt="Кристалл" class="counter-icon"> 
        <span id="totalCrystals">0</span>
    </div>
    <div id="keysCount">
        <img src="key.png" alt="Ключ" class="counter-icon">
        <span id="totalKeys">0</span>
    </div>
    
<div id="purchase-message" style="display: none;"></div> <!-- Для сообщений о покупке и доступности подарка -->

<!-- Подарок дня -->
<div id="dailyGift" onclick="claimGift()" style="border: 2px solid white; padding: 20px; margin-top: 20px; text-align: center; border-radius: 10px; color: white;">
    <h2>🎁 Подарок дня</h2>
    <p id="giftMessage"><span id="giftTimer"></span></p>
</div>


     <!-- Вкладки для категорий -->
     <div class="tabs">
        <button class="tab active" onclick="openTab('keys')">Ключи</button>
        <button class="tab" onclick="openTab('skins')">Скины</button>
    </div>

    <!-- Контент для Ключей -->
    <div id="keys" class="tabcontent active">
        <div class="shop-item">
            <div class="shop-button"><img src="key.png" alt="10 ключей"></div>
            <div class="item-description">10 ключей</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>1500</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="key.png" alt="50 ключей"></div>
            <div class="item-description">50 ключей</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>3200</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="key.png" alt="100 ключей"></div>
            <div class="item-description">100 ключей</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>10000</span>
            </button>
        </div>
          <!-- Новые ящики -->
    <div class="shop-item">
        <div class="shop-button"><img src="1p.png" alt="Ящик за 1000 кристаллов"></div>
        <div class="item-description">маленький подарок</div>
        <button class="buy-button" onclick="buyBox(1000, 0)">
            <img src="5.png" alt="Кристаллы">
            <span>1000</span>
        </button>
    </div>
    <div class="shop-item">
        <div class="shop-button"><img src="2p.png" alt="Ящик за 2500 кристаллов"></div>
        <div class="item-description">средний подарок</div>
        <button class="buy-button" onclick="buyBox(2500, 1)">
            <img src="5.png" alt="Кристаллы">
            <span>2500</span>
        </button>
    </div>
    <div class="shop-item">
        <div class="shop-button"><img src="3p.png" alt="Ящик за 4000 кристаллов"></div>
        <div class="item-description">большой подарок</div>
        <button class="buy-button" onclick="buyBox(4000, 2)">
            <img src="5.png" alt="Кристаллы">
            <span>4000</span>
        </button>
    </div>
</div>

<div id="reward-counter"></div>
    </div>

    <!-- Контент для Скинов -->
    <div id="skins" class="tabcontent">
        <div class="shop-item">
            <div class="shop-button"><img src="1.jpg" alt="Скин: Halloween"></div>
            <div class="item-description">Скин: Halloween</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>6000</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="e.png" alt="Скин: Летучая мышь"></div>
            <div class="item-description">Скин: Летучая мышь</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>5500</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="w.jpg" alt="Скин: Белый квадрат"></div>
            <div class="item-description">Скин: Белый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>3700</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="yl.png" alt="Скин: Желтый"></div>
            <div class="item-description">Скин: Желтый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>1500</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="green.jpg" alt="Скин: Зеленый квадрат"></div>
            <div class="item-description">Скин: Зеленый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>1900</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="o.png" alt="Скин: Оранжевый квадрат"></div>
            <div class="item-description">Скин: Оранжевый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>1600</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="rrr.jpg" alt="Скин: Розовый квадрат"></div>
            <div class="item-description">Скин: Розовый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>2000</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="fff.png" alt="Скин: Фиолетовый квадрат"></div>
            <div class="item-description">Скин: Фиолетовый</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>2500</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="snow.png" alt="Скин: Снеговик"></div>
            <div class="item-description">Скин: Снеговик</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>4000</span>
            </button>
        </div>
        <div class="shop-item">
            <div class="shop-button"><img src="dedd.png" alt="Скин: Дед Мороз"></div>
            <div class="item-description">Скин: Санта</div>
            <button class="buy-button">
                <img src="5.png" alt="Кристаллы">
                <span>5500</span>
            </button>
        </div>
        
        
    </div>


    <div class="stars">
        <div class="star" style="top: 10px; left: 20px; animation-duration: 6s;"></div>
        <div class="star" style="top: 50px; left: 80px; animation-duration: 4s;"></div>
        <div class="star" style="top: 150px; left: 40px; animation-duration: 5s;"></div>
        <div class="star" style="top: 200px; left: 100px; animation-duration: 3s;"></div>
        <div class="star" style="top: 250px; left: 60px; animation-duration: 6s;"></div>
        <div class="star" style="top: 300px; left: 120px; animation-duration: 4.5s;"></div>
        <div class="star" style="top: 350px; left: 200px; animation-duration: 5.5s;"></div>
        <div class="star" style="top: 400px; left: 150px; animation-duration: 3.5s;"></div>
        <div class="star" style="top: 450px; left: 250px; animation-duration: 4.2s;"></div>
        <div class="star" style="top: 500px; left: 300px; animation-duration: 5.8s;"></div>
    </div>

    <div class="stars"></div>

    <div class="footer">
        <div class="footer-item" onclick="goToMenu()">
            <img src="m.png" alt="Exchange">
            <span>Menu</span>
        </div>
        <div class="footer-item" onclick="goToShop()">
            <img src="t.png" alt="Mine">
            <span>Shop</span>
        </div>
        <div class="footer-item" onclick="goToFriends()">
            <img src="f.png" alt="Friends">
            <span>Friends</span>
        </div>
        <div class="footer-item" onclick="goToSkins()">
            <img src="cl.png" alt="Skins"> <!-- Добавьте сюда нужный значок для "Skins" -->
            <span>Skins</span>
        </div>
    </div>
    
    <script>
 function openTab(tabName) {
    let tabcontent = document.getElementsByClassName("tabcontent");
    let tabs = document.getElementsByClassName("tab");

    // Скрыть весь контент вкладок и удалить активные классы
    for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
    }

    for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove("active");
    }

    // Показать только выбранный контент
    document.getElementById(tabName).classList.add("active");

    // Установить активный класс на нажатую вкладку
    event.currentTarget.classList.add("active");

    // Управление видимостью раздела "Скины"
    const skinsSection = document.getElementById('skins');
    if (tabName === 'skins') {
        skinsSection.classList.add('active');
    } else {
        skinsSection.classList.remove('active');
    }
}



                   function goToMenu() {
        window.location.href = "menu.html"; // Страница для меню
    }

    function goToShop() {
        window.location.href = "shop.html"; // Страница для магазина
    }

    function goToFriends() {
        window.location.href = "friends.html"; // Страница для друзей
    }
    function goToSkins() {
    window.location.href = "skins.html"; // Страница для скинов
}
 
      // Проверка на перезагрузку страницы
    if (performance.navigation.type === 1) {
        window.location.href = 'index.html';
    }

    // Получаем текущее количество кристаллов и ключей
    let totalCrystals = localStorage.getItem('totalCrystals') || 0;
    let totalKeys = localStorage.getItem('totalKeys') || 0;
    document.getElementById('totalCrystals').textContent = totalCrystals;
    document.getElementById('totalKeys').textContent = totalKeys;
    function resetGame() {
    localStorage.clear(); // Очищаем все данные
    window.location.reload(); // Перезагружаем страницу для сброса интерфейса
}
// Логика "Подарка дня"
function getRandomGift() {
    const isJackpot = Math.random() < 0.05; // 5% шанс на джекпот
    const giftType = Math.random() < 0.5 ? 'keys' : 'crystals';
    let amount, message;

    if (giftType === 'keys') {
        amount = isJackpot ? 11 : Math.floor(Math.random() * 11) + 1; // от 1 до 11 ключей
        message = `${amount} ключей ${isJackpot ? '🎉 Джекпот!' : ''}`;
        totalKeys = parseInt(localStorage.getItem('totalKeys') || '0') + amount;
        localStorage.setItem('totalKeys', totalKeys);
        document.getElementById('totalKeys').textContent = totalKeys;
    } else {
        amount = isJackpot ? 2000 : Math.floor(Math.random() * 1801) + 200; // от 200 до 2000 кристаллов
        message = `${amount} кристаллов ${isJackpot ? '🎉 Джекпот!' : ''}`;
        totalCrystals = parseInt(localStorage.getItem('totalCrystals') || '0') + amount;
        localStorage.setItem('totalCrystals', totalCrystals);
        document.getElementById('totalCrystals').textContent = totalCrystals;
    }

    document.getElementById('giftMessage').textContent = `Получено: ${message}`;
}

// Функция показа уведомления в центре
function showCenteredMessage(message) {
    const purchaseMessage = document.getElementById('purchase-message');
    purchaseMessage.textContent = message;
    purchaseMessage.style.visibility = 'visible';
    purchaseMessage.style.opacity = '1';
    purchaseMessage.style.display = 'block';

    // Скрываем сообщение через 2 секунды
    setTimeout(() => {
        purchaseMessage.style.opacity = '0';
        purchaseMessage.style.visibility = 'hidden';
        purchaseMessage.style.display = 'none';
    }, 2000);
}

// Функция получения подарка
function claimGift() {
    const lastGiftTime = parseInt(localStorage.getItem('lastGiftTime') || '0');
    const now = Date.now();
    const threeHours = 3 * 60 * 60 * 1000;

    if (now - lastGiftTime >= threeHours) {
        getRandomGift();
        localStorage.setItem('lastGiftTime', now);
        document.getElementById('dailyGift').classList.remove('available');
    } else {
        showCenteredMessage("Подарок пока не доступен. Подождите завершения таймера.");
    }
}

// Таймер, который обновляет состояние подарка
function startGiftTimer() {
    setInterval(() => {
        const timeRemaining = 3 * 60 * 60 * 1000 - (Date.now() - parseInt(localStorage.getItem('lastGiftTime') || '0'));
        
        if (timeRemaining <= 0) {
            document.getElementById('giftTimer').textContent = "Доступен! Нажмите, чтобы забрать!";
            document.getElementById('dailyGift').classList.add('available'); // Добавляем анимацию
        } else {
            document.getElementById('dailyGift').classList.remove('available'); // Убираем анимацию
            const hours = Math.floor(timeRemaining / (60 * 60 * 1000));
            const minutes = Math.floor((timeRemaining % (60 * 60 * 1000)) / (60 * 1000));
            const seconds = Math.floor((timeRemaining % (60 * 1000)) / 1000);
            document.getElementById('giftTimer').textContent = `${hours}ч ${minutes}м ${seconds}с`;
        }
    }, 1000);
}

// Запуск таймера при загрузке страницы
window.addEventListener('load', startGiftTimer);
document.addEventListener('DOMContentLoaded', function () {
    const purchasedSkins = JSON.parse(localStorage.getItem('purchasedSkins') || '[]');
    const skinItems = document.querySelectorAll('#skins .shop-item');

    skinItems.forEach((item, index) => {
        const skinButton = item.querySelector('.buy-button');
        let skinName;

        if (index === 0) skinName = 'halloween';
        else if (index === 1) skinName = 'bat';
        else if (index === 2) skinName = 'white_square';
        else if (index === 3) skinName = 'yellow'; // Новый скин
        else if (index === 4) skinName = 'green_square'; // Новый скин
        else if (index === 5) skinName = 'orange_square'; // Новый скин
        else if (index === 6) skinName = 'pink_square'; // Новый скин
        else if (index === 7) skinName = 'purple_square'; // Новый скин
        else if (index === 8) skinName = 'snowman'; // Новый скин
        else if (index === 9) skinName = 'santa'; // Новый скин


        if (purchasedSkins.includes(skinName)) {
            skinButton.textContent = 'Куплено';
            skinButton.disabled = true;
            item.style.display = 'none'; // Убираем купленный скин из магазина
        }
    });
});




    document.querySelectorAll('.buy-button').forEach((button, index) => {
    button.addEventListener('click', function () {
        const cost = parseInt(this.querySelector('span').textContent);
        let totalCrystals = parseInt(localStorage.getItem('totalCrystals') || '0');

        // Проверка достаточности кристаллов
        if (totalCrystals < cost) {
            showCenteredMessage('У вас недостаточно кристаллов');
            return; // Завершаем выполнение функции, если кристаллов недостаточно
        }

        // Если кристаллов достаточно, производим покупку
        totalCrystals -= cost;
        localStorage.setItem('totalCrystals', totalCrystals);
        document.getElementById('totalCrystals').textContent = totalCrystals;

        if (index <= 2) { // Покупка ключей
            let keysToBuy;
            switch (index) {
                case 0: keysToBuy = 10; break;
                case 1: keysToBuy = 50; break;
                case 2: keysToBuy = 100; break;
            }
            let totalKeys = parseInt(localStorage.getItem('totalKeys') || '0');
            totalKeys += keysToBuy;
            localStorage.setItem('totalKeys', totalKeys);
            document.getElementById('totalKeys').textContent = totalKeys;
            showPurchaseMessage(`Куплено ${keysToBuy} ключей за ${cost} кристаллов`);
        } else { // Покупка скинов
            let skin;
            if (index === 3) skin = 'halloween';
            else if (index === 4) skin = 'bat';
            else if (index === 5) skin = 'white_square';
            else if (index === 6) skin = 'yellow';
            else if (index === 7) skin = 'green_square';
            else if (index === 8) skin = 'orange_square';
            else if (index === 9) skin = 'pink_square';
            else if (index === 10) skin = 'purple_square'; // Новый скин
            else if (index === 11) skin = 'snowman'; // Новый скин
            else if (index === 12) skin = 'santa'; // Новый скин




        const purchasedSkins = JSON.parse(localStorage.getItem('purchasedSkins') || '[]');

        if (!purchasedSkins.includes(skin)) {
            purchasedSkins.push(skin); // Сохраняем покупку
            localStorage.setItem('purchasedSkins', JSON.stringify(purchasedSkins));
        }

        // Обновляем состояние кнопки
        this.textContent = 'Куплено';
        this.disabled = true;

        // Убираем купленный скин из магазина
        this.closest('.shop-item').style.display = 'none';
    }
    });
});


// Функция для отображения сообщения о покупке
function showPurchaseMessage(message) {
    const purchaseMessage = document.getElementById('purchase-message');
    purchaseMessage.textContent = message;
    purchaseMessage.style.visibility = 'visible';
    purchaseMessage.style.opacity = '1';

    // Скрываем сообщение через 2 секунды
    setTimeout(() => {
        purchaseMessage.style.opacity = '0';
        purchaseMessage.style.visibility = 'hidden';
    }, 2000);
}


const boxes = [
        { minCrystals: 100, maxCrystals: 500, minKeys: 3, maxKeys: 7, rareChance: 10, maxItems: 3 },
        { minCrystals: 500, maxCrystals: 1100, minKeys: 5, maxKeys: 25, rareChance: 30, maxItems: 3 },
        { minCrystals: 1500, maxCrystals: 2500, minKeys: 10, maxKeys: 25, rareChance: 50, maxItems: 4 }
    ];

    function buyBox(cost, boxIndex) {
        let totalCrystals = parseInt(localStorage.getItem('totalCrystals') || '0');

        if (totalCrystals < cost) {
            alert('У вас недостаточно кристаллов.');
            return;
        }

        totalCrystals -= cost;
        localStorage.setItem('totalCrystals', totalCrystals);
        document.getElementById('totalCrystals').textContent = totalCrystals;

        openBoxAnimation(boxIndex);
    }

    function openBoxAnimation(boxIndex) {
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';
        overlay.style.zIndex = '1000';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        document.body.appendChild(overlay);

        const boxImage = document.createElement('img');
        boxImage.src = `${boxIndex + 1}p.png`;
        boxImage.style.width = '150px';
        boxImage.style.height = '150px';
        boxImage.style.animation = 'boxOpen 1.5s forwards';
        overlay.appendChild(boxImage);

        boxImage.addEventListener('animationend', () => {
            const rewards = generateRewards(boxIndex);
            overlay.removeChild(boxImage);
            displayRewards(rewards, overlay);
        });
    }
    const availableSkins = [
    'halloween', 'bat', 'white_square', 'yellow',
    'green_square', 'orange_square', 'pink_square',
    'purple_square', 'snowman', 'santa'
];

// При выпадении скина
function handleSkinDrop(skinName) {
    const purchasedSkins = JSON.parse(localStorage.getItem('purchasedSkins') || '[]');
    if (!purchasedSkins.includes(skinName)) {
        purchasedSkins.push(skinName);
        localStorage.setItem('purchasedSkins', JSON.stringify(purchasedSkins));
        alert(`Вам выпал новый скин: ${skinName}!`);
    }
}

// Открытие ящика
function generateRewards(boxIndex) {
    const box = boxes[boxIndex];
    const rewards = [];

    // Генерация кристаллов и ключей
    const crystalReward = Math.floor(Math.random() * (box.maxCrystals - box.minCrystals + 1)) + box.minCrystals;
    const keyReward = Math.floor(Math.random() * (box.maxKeys - box.minKeys + 1)) + box.minKeys;

    rewards.push({ type: 'crystals', amount: crystalReward });
    rewards.push({ type: 'keys', amount: keyReward });

    // Шанс на редкий скин
    if (Math.random() * 100 < box.rareChance) {
        const availableUnownedSkins = availableSkins.filter(skin => {
            const purchasedSkins = JSON.parse(localStorage.getItem('purchasedSkins') || '[]');
            return !purchasedSkins.includes(skin);
        });

        if (availableUnownedSkins.length > 0) {
            const randomSkin = availableUnownedSkins[Math.floor(Math.random() * availableUnownedSkins.length)];
            rewards.push({ type: 'skin', skin: randomSkin });
            handleSkinDrop(randomSkin);
        }
    }

    return rewards;
}

    function displayRewards(rewards, overlay) {
        let delay = 0;

        rewards.forEach((reward) => {
            const rewardElement = document.createElement('div');
            rewardElement.className = 'reward-display';
            rewardElement.style.animation = `fadeInMove 0.5s ${delay}s forwards`;
            delay += 0.5;

            const rewardImage = document.createElement('img');
            if (reward.type === 'crystals') {
                rewardImage.src = '5.png';
                rewardElement.textContent = `+${reward.amount} Кристаллы`;

                // Добавляем кристаллы на счет
                let currentCrystals = parseInt(localStorage.getItem('totalCrystals') || '0');
                currentCrystals += reward.amount;
                localStorage.setItem('totalCrystals', currentCrystals);
                document.getElementById('totalCrystals').textContent = currentCrystals;

            } else if (reward.type === 'keys') {
                rewardImage.src = 'key.png';
                rewardElement.textContent = `+${reward.amount} Ключи`;

                // Добавляем ключи на счет
                let currentKeys = parseInt(localStorage.getItem('totalKeys') || '0');
                currentKeys += reward.amount;
                localStorage.setItem('totalKeys', currentKeys);
                document.getElementById('totalKeys').textContent = currentKeys;

            } else if (reward.type === 'skins') {
                rewardElement.textContent = `+${reward.amount} Новый скин!`;

                // Обновление скинов (если они добавляются как отдельный ресурс)
                let purchasedSkins = JSON.parse(localStorage.getItem('purchasedSkins') || '[]');
                for (let i = 0; i < reward.amount; i++) {
                    purchasedSkins.push(`skin_${Date.now() + i}`); // Уникальный ID для каждого скина
                }
                localStorage.setItem('purchasedSkins', JSON.stringify(purchasedSkins));
            }
            rewardElement.prepend(rewardImage);

            overlay.appendChild(rewardElement);

            setTimeout(() => overlay.removeChild(rewardElement), 3000);
        });

        setTimeout(() => document.body.removeChild(overlay), 5000);
    }

    </script>
    
</body>
</html>